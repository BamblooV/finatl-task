"use strict";(self.webpackChunkfinal_task=self.webpackChunkfinal_task||[]).push([[434],{434:(H,f,s)=>{s.r(f),s.d(f,{GroupDialogComponent:()=>Y});var g=s(6814),v=s(9397),M=s(9315),d=s(7398),G=s(4664),Z=s(9080),T=s(7921),x=s(8180),m=s(4087),C=s(336),b=s(6465),t=s(5879),r=s(6223);let A=(()=>{class n{el;ngModel;control;cd;autoResize;onResize=new t.vpe;filled;cachedScrollHeight;ngModelSubscription;ngControlSubscription;constructor(e,o,i,a){this.el=e,this.ngModel=o,this.control=i,this.cd=a}ngOnInit(){this.ngModel&&(this.ngModelSubscription=this.ngModel.valueChanges.subscribe(()=>{this.updateState()})),this.control&&(this.ngControlSubscription=this.control.valueChanges.subscribe(()=>{this.updateState()}))}ngAfterViewChecked(){this.updateState()}ngAfterViewInit(){this.autoResize&&this.resize(),this.updateFilledState(),this.cd.detectChanges()}onInput(e){this.updateState()}updateFilledState(){this.filled=this.el.nativeElement.value&&this.el.nativeElement.value.length}resize(e){this.el.nativeElement.style.height="auto",this.el.nativeElement.style.height=this.el.nativeElement.scrollHeight+"px",parseFloat(this.el.nativeElement.style.height)>=parseFloat(this.el.nativeElement.style.maxHeight)?(this.el.nativeElement.style.overflowY="scroll",this.el.nativeElement.style.height=this.el.nativeElement.style.maxHeight):this.el.nativeElement.style.overflow="hidden",this.onResize.emit(e||{})}updateState(){this.updateFilledState(),this.autoResize&&this.resize()}ngOnDestroy(){this.ngModelSubscription&&this.ngModelSubscription.unsubscribe(),this.ngControlSubscription&&this.ngControlSubscription.unsubscribe()}static \u0275fac=function(o){return new(o||n)(t.Y36(t.SBq),t.Y36(r.On,8),t.Y36(r.a5,8),t.Y36(t.sBO))};static \u0275dir=t.lG2({type:n,selectors:[["","pInputTextarea",""]],hostAttrs:[1,"p-inputtextarea","p-inputtext","p-component","p-element"],hostVars:4,hostBindings:function(o,i){1&o&&t.NdJ("input",function(l){return i.onInput(l)}),2&o&&t.ekj("p-filled",i.filled)("p-inputtextarea-resizable",i.autoResize)},inputs:{autoResize:"autoResize"},outputs:{onResize:"onResize"}})}return n})(),z=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=t.oAB({type:n});static \u0275inj=t.cJS({imports:[g.ez]})}return n})();var D=s(5219),y=s(3904),I=s(2628),h=s(2485),c=s(2183),O=s(8865),S=s(4221);const w=["messageList"];function B(n,p){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=p.ngIf;t.xp6(1),t.hij(" ",e.message,"\n")}}function L(n,p){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=p.ngIf;t.xp6(1),t.hij(" ",e," ")}}function U(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"p-button",14),t.NdJ("onClick",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.deleteGroup())}),t.ALo(1,"async"),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("disabled",!!t.lcZ(1,1,e.loading$))}}function $(n,p){if(1&n&&(t.TgZ(0,"div",15),t.ALo(1,"async"),t.TgZ(2,"div",16)(3,"div",17),t._uU(4),t.ALo(5,"async"),t.qZA(),t.TgZ(6,"div",18),t._uU(7),t.ALo(8,"date"),t.qZA()(),t.TgZ(9,"div",19),t._uU(10),t.qZA()()),2&n){const e=p.$implicit,o=t.oxw(2);let i;t.ekj("my-message",e.authorID===t.lcZ(1,5,o.userID$)),t.xp6(4),t.Oqu((null==(i=t.lcZ(5,7,o.getUsername$(e.authorID)))?null:i.name)||"Anonym"),t.xp6(3),t.Oqu(t.lcZ(8,9,e.createdAt)),t.xp6(3),t.Oqu(e.message)}}function E(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"div",2),t._UZ(1,"p-button",3),t.TgZ(2,"p-button",4),t.NdJ("onClick",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.updateMessages())}),t.ALo(3,"async"),t.ALo(4,"async"),t.qZA(),t.YNc(5,L,2,1,"span",5),t.ALo(6,"async"),t.YNc(7,U,2,3,"p-button",6),t.ALo(8,"async"),t.qZA(),t.TgZ(9,"div",7)(10,"div",8,9),t.YNc(12,$,11,11,"div",10),t.ALo(13,"async"),t.qZA(),t.TgZ(14,"div",11),t._UZ(15,"textarea",12),t.TgZ(16,"p-button",13),t.NdJ("onClick",function(i){return t.CHM(e),t.oxw().onSubmit(),t.KtG(i.preventDefault())}),t.ALo(17,"async"),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("link",!0),t.xp6(1),t.Q6J("disabled",!!t.lcZ(3,9,e.loading$)||t.lcZ(4,11,e.countDown$)>0),t.xp6(3),t.Q6J("ngIf",t.lcZ(6,13,e.countDown$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(8,15,e.isGroupOwner$)),t.xp6(5),t.Q6J("ngForOf",t.lcZ(13,17,e.messages$)),t.xp6(3),t.Q6J("autoResize",!0)("formControl",e.inputControl),t.xp6(1),t.Q6J("rounded",!0)("disabled",!!t.lcZ(17,19,e.loading$)||e.inputControl.invalid)}}const J=function(){return{width:"50vw"}};let Y=(()=>{class n{updateMessages(){this.store.dispatch(c.B.updateMessages({groupID:this.selectedGroupID}))}deleteGroup(){this.confirmationService.confirm({message:"Do you want to delete your group?",header:"Delete Confirmation",icon:"pi pi-info-circle",accept:()=>{this.store.dispatch(h.a.deleteGroup({groupID:this.selectedGroupID}))}})}onSubmit(){this.inputControl.invalid||this.inputControl.value&&(this.store.dispatch(c.B.sendMessage({groupID:this.selectedGroupID,message:this.inputControl.value})),this.inputControl.reset())}getUsername$(e){return this.store.select(O.l.selectUserByID(e))}scrollToBottom(){try{this.messageList.nativeElement.scrollTop=this.messageList.nativeElement.scrollHeight}catch{console.log("error while scroll to bottom")}}constructor(e,o,i,a){this.store=e,this.router=o,this.activatedRoute=i,this.confirmationService=a,this.selectedGroupID=this.activatedRoute.snapshot.paramMap.get("groupID")||"",this.messages$=this.store.select(c.c.selectGroupMessages(this.selectedGroupID)).pipe((0,v.b)(()=>this.scrollToBottom())),this.loading$=(0,M.D)([this.store.select(c.c.selectLoading),this.store.select(h.D.selectGroupsLoading)]).pipe((0,d.U)(l=>l.some(u=>u))),this.error$=this.store.select(c.c.selectError),this.isGroupOwner$=this.store.select(h.D.selectGroup(this.selectedGroupID)).pipe((0,b.IC)(()=>this.store.select(I.c.PB)),(0,d.U)(([l,u])=>l?.createdBy===u)),this.userID$=this.store.select(I.c.PB),this.timeDelay$=this.store.select(c.c.selectLastUpdateTime).pipe((0,d.U)(l=>{if(!l)return 0;const u=Math.round(l/1e3),F=Math.round(Date.now()/1e3);return Math.max(60-(F-u),0)})),this.countDown$=this.timeDelay$.pipe((0,G.w)(l=>(0,Z.H)(0,1e3).pipe((0,T.O)(0),(0,x.q)(l+2),(0,d.U)(u=>l-u)))),this.inputControl=new r.NI("",[r.kI.required]),this.store.select(h.D.selectGroups).pipe((0,x.q)(1),(0,v.b)(l=>{(!l||!Object.hasOwn(l,this.selectedGroupID))&&this.router.navigateByUrl("not-found",{skipLocationChange:!0})})).subscribe()}ngOnInit(){this.store.dispatch(c.B.fetchMessages({groupID:this.selectedGroupID}))}ngAfterViewChecked(){this.scrollToBottom()}static#t=this.\u0275fac=function(o){return new(o||n)(t.Y36(S.yh),t.Y36(m.F0),t.Y36(m.gz),t.Y36(D.YP))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-group-dialog"]],viewQuery:function(o,i){if(1&o&&t.Gf(w,5),2&o){let a;t.iGM(a=t.CRH())&&(i.messageList=a.first)}},standalone:!0,features:[t._Bn([D.YP]),t.jDz],decls:5,vars:7,consts:[[4,"ngIf","ngIfElse"],["content",""],[1,"controls"],["label","Go home","routerLink","/","size","small",3,"link"],["label","Update","size","small",3,"disabled","onClick"],[4,"ngIf"],["label","Delete","size","small",3,"disabled","onClick",4,"ngIf"],[1,"messenger-container"],[1,"message-list"],["messageList",""],["class","message",3,"my-message",4,"ngFor","ngForOf"],[1,"send-form"],["rows","3","cols","80","pInputTextarea","","placeholder","Type a message",3,"autoResize","formControl"],["icon","pi pi-send",3,"rounded","disabled","onClick"],["label","Delete","size","small",3,"disabled","onClick"],[1,"message"],[1,"meta"],[1,"name"],[1,"time"],[1,"text"]],template:function(o,i){if(1&o&&(t.YNc(0,B,2,1,"ng-container",0),t.ALo(1,"async"),t.YNc(2,E,18,21,"ng-template",null,1,t.W1O),t._UZ(4,"p-confirmDialog")),2&o){const a=t.MAs(3);t.Q6J("ngIf",t.lcZ(1,4,i.error$))("ngIfElse",a),t.xp6(4),t.Akn(t.DdM(6,J))}},dependencies:[g.ez,g.sg,g.O5,g.Ov,g.uU,r.UX,r.Fj,r.JJ,r.oH,m.Bz,m.rH,C.hJ,C.zx,z,A,y.D,y.Q],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.controls[_ngcontent-%COMP%]{padding:.5rem;display:flex;flex-direction:row;gap:.75rem;align-items:center}.send-form[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:1rem;justify-content:space-between;margin-top:1rem}.messenger-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.message-list[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem;overflow-y:scroll;padding-bottom:20px;height:calc(80vh - 82px)}.message[_ngcontent-%COMP%]{border:1px solid var(--teal-100);border-radius:5px;width:-moz-fit-content;width:fit-content;max-width:70%;min-width:30%;padding:1rem;display:flex;flex-direction:column;gap:1rem}.my-message[_ngcontent-%COMP%]{align-self:flex-end}.meta[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.time[_ngcontent-%COMP%]{font-size:.5rem}.name[_ngcontent-%COMP%]{font-weight:700}"],changeDetection:0})}return n})()}}]);