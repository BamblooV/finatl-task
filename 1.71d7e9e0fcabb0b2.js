"use strict";(self.webpackChunkfinal_task=self.webpackChunkfinal_task||[]).push([[1],{2001:($,u,n)=>{n.r(u),n.d(u,{PersonConversationComponent:()=>K});var m=n(6814),p=n(4087),C=n(5219),M=n(9397),E=n(9315),d=n(7398),P=n(4664),x=n(9080),O=n(7921),I=n(8180),T=n(2628),c=n(6223),h=n(336),v=n(3904),f=n(6218),a=n(2385),D=n(8865),t=n(5879),A=n(4221);const U=["messageList"];function L(o,_){if(1&o&&(t.ynx(0),t._uU(1),t.BQk()),2&o){const e=_.ngIf;t.xp6(1),t.hij(" ",e.message,"\n")}}function y(o,_){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=_.ngIf;t.xp6(1),t.hij(" ",e," ")}}function Z(o,_){if(1&o&&(t.TgZ(0,"div",14),t.ALo(1,"async"),t.TgZ(2,"div",15)(3,"div",16),t._uU(4),t.ALo(5,"async"),t.qZA(),t.TgZ(6,"div",17),t._uU(7),t.ALo(8,"date"),t.qZA()(),t.TgZ(9,"div",18),t._uU(10),t.qZA()()),2&o){const e=_.$implicit,s=t.oxw(2);let i;t.ekj("my-message",e.authorID===t.lcZ(1,5,s.userID$)),t.xp6(4),t.Oqu((null==(i=t.lcZ(5,7,s.getUsername$(e.authorID)))?null:i.name)||"Anonym"),t.xp6(3),t.Oqu(t.lcZ(8,9,e.createdAt)),t.xp6(3),t.Oqu(e.message)}}function B(o,_){if(1&o){const e=t.EpF();t.TgZ(0,"div",2),t._UZ(1,"p-button",3),t.TgZ(2,"p-button",4),t.NdJ("onClick",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.updateMessages())}),t.ALo(3,"async"),t.ALo(4,"async"),t.qZA(),t.YNc(5,y,2,1,"span",5),t.ALo(6,"async"),t.TgZ(7,"p-button",6),t.NdJ("onClick",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.deleteConversation())}),t.ALo(8,"async"),t.qZA()(),t.TgZ(9,"div",7)(10,"div",8,9),t.YNc(12,Z,11,11,"div",10),t.ALo(13,"async"),t.qZA(),t.TgZ(14,"div",11),t._UZ(15,"textarea",12),t.TgZ(16,"p-button",13),t.NdJ("onClick",function(i){return t.CHM(e),t.oxw().onSubmit(),t.KtG(i.preventDefault())}),t.ALo(17,"async"),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("link",!0),t.xp6(1),t.Q6J("disabled",!!t.lcZ(3,9,e.loading$)||t.lcZ(4,11,e.countDown$)>0),t.xp6(3),t.Q6J("ngIf",t.lcZ(6,13,e.countDown$)),t.xp6(2),t.Q6J("disabled",!!t.lcZ(8,15,e.loading$)),t.xp6(5),t.Q6J("ngForOf",t.lcZ(13,17,e.messages$)),t.xp6(3),t.Q6J("autoResize",!0)("formControl",e.inputControl),t.xp6(1),t.Q6J("rounded",!0)("disabled",!!t.lcZ(17,19,e.loading$)||e.inputControl.invalid)}}const R=function(){return{width:"50vw"}};let K=(()=>{class o{updateMessages(){this.store.dispatch(a.q.updateMessages({conversationID:this.selectedConversationID}))}deleteConversation(){this.confirmationService.confirm({message:"Do you want to delete conversation?",header:"Delete Confirmation",icon:"pi pi-info-circle",accept:()=>{this.store.dispatch(a.q.deleteConversation({conversationID:this.selectedConversationID}))}})}onSubmit(){this.inputControl.invalid||this.inputControl.value&&(this.store.dispatch(a.q.sendMessage({conversationID:this.selectedConversationID,message:this.inputControl.value})),this.inputControl.reset())}getUsername$(e){return this.store.select(D.l.selectUserByID(e))}scrollToBottom(){try{this.messageList.nativeElement.scrollTop=this.messageList.nativeElement.scrollHeight}catch{console.log("error while scroll to bottom")}}constructor(e,s,i,r){this.store=e,this.router=s,this.activatedRoute=i,this.confirmationService=r,this.selectedConversationID=this.activatedRoute.snapshot.paramMap.get("conversationID")||"",this.messages$=this.store.select(a.w.selectConversationMessages(this.selectedConversationID)).pipe((0,M.b)(()=>this.scrollToBottom())),this.loading$=(0,E.D)([this.store.select(a.w.selectLoading),this.store.select(D.l.selectUsersLoading)]).pipe((0,d.U)(l=>l.some(g=>g))),this.error$=this.store.select(a.w.selectError),this.userID$=this.store.select(T.c.PB),this.timeDelay$=this.store.select(a.w.selectLastUpdateTime).pipe((0,d.U)(l=>{if(!l)return 0;const g=Math.round(l/1e3),W=Math.round(Date.now()/1e3);return Math.max(60-(W-g),0)})),this.countDown$=this.timeDelay$.pipe((0,P.w)(l=>(0,x.H)(0,1e3).pipe((0,O.O)(0),(0,I.q)(l+2),(0,d.U)(g=>l-g)))),this.inputControl=new c.NI("",[c.kI.required])}ngOnInit(){this.store.dispatch(a.q.fetchMessages({conversationID:this.selectedConversationID}))}ngAfterViewChecked(){this.scrollToBottom()}static#t=this.\u0275fac=function(s){return new(s||o)(t.Y36(A.yh),t.Y36(p.F0),t.Y36(p.gz),t.Y36(C.YP))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-person-conversation"]],viewQuery:function(s,i){if(1&s&&t.Gf(U,5),2&s){let r;t.iGM(r=t.CRH())&&(i.messageList=r.first)}},standalone:!0,features:[t._Bn([C.YP]),t.jDz],decls:5,vars:7,consts:[[4,"ngIf","ngIfElse"],["content",""],[1,"controls"],["label","Go home","routerLink","/","size","small",3,"link"],["label","Update","size","small",3,"disabled","onClick"],[4,"ngIf"],["label","Delete","size","small",3,"disabled","onClick"],[1,"messenger-container"],[1,"message-list"],["messageList",""],["class","message",3,"my-message",4,"ngFor","ngForOf"],[1,"send-form"],["rows","3","cols","80","pInputTextarea","","placeholder","Type a message",3,"autoResize","formControl"],["icon","pi pi-send",3,"rounded","disabled","onClick"],[1,"message"],[1,"meta"],[1,"name"],[1,"time"],[1,"text"]],template:function(s,i){if(1&s&&(t.YNc(0,L,2,1,"ng-container",0),t.ALo(1,"async"),t.YNc(2,B,18,21,"ng-template",null,1,t.W1O),t._UZ(4,"p-confirmDialog")),2&s){const r=t.MAs(3);t.Q6J("ngIf",t.lcZ(1,4,i.error$))("ngIfElse",r),t.xp6(4),t.Akn(t.DdM(6,R))}},dependencies:[m.ez,m.sg,m.O5,m.Ov,m.uU,c.UX,c.Fj,c.JJ,c.oH,p.Bz,p.rH,h.hJ,h.zx,f.A,f.g,v.D,v.Q],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.controls[_ngcontent-%COMP%]{padding:.5rem;display:flex;flex-direction:row;gap:.75rem;align-items:center}.send-form[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:1rem;justify-content:space-between;margin-top:1rem}.messenger-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.message-list[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.5rem;overflow-y:scroll;padding-bottom:20px;height:calc(80vh - 82px)}.message[_ngcontent-%COMP%]{border:1px solid var(--teal-100);border-radius:5px;width:-moz-fit-content;width:fit-content;max-width:70%;min-width:30%;padding:1rem;display:flex;flex-direction:column;gap:1rem}.my-message[_ngcontent-%COMP%]{align-self:flex-end}.meta[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.time[_ngcontent-%COMP%]{font-size:.5rem}.name[_ngcontent-%COMP%]{font-weight:700}"],changeDetection:0})}return o})()}}]);